<sequence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		disabled="false"
		id="796b2031a5f0487ca5ee758425ab9a81"
		lineNumber="1">
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Set default locked to false"
			disabled="false"
			id="36c70ae028084f53aceb3704d5348663"
			lineNumber="2">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="ea783b4a6ab7474d8c96c9aa0c0c10be"
				serviceId="nabu.frameworks.locks.crud.lockDefinition.services.list"
				resultName="resultb10da90d49944a95ab9b54c902754fd9"
				temporaryMapping="true"
				x="127"
				y="51"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="5350967418454e819440c269edde945c"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/name</from>
				<to>filter/name[0]</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="75854e2fb0434509ab75002370fe2ff0"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultb10da90d49944a95ab9b54c902754fd9/results[0]</from>
			<to>lockDefinition</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="e536a7f1d09d4f7eb2ecefc3a577dce2"
				mask="false"
				optional="false"
				fixedValue="true">
			<from>false</from>
			<to>output/locked</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
			comment="Create"
			disabled="false"
			id="c0d726ec604b4257ad0502d7c959909a"
			label="!lockDefinition"
			lineNumber="3">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="151e320cd78b4786a4b9f2c9a6dd1245"
				lineNumber="4">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="63df3d4327694a44a3f6aa37d7736a04"
					serviceId="nabu.utils.Lock.lock"
					resultName="result1f1ebeefe25c4768b01455588e11787f"
					temporaryMapping="true"
					x="229"
					y="140"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="cd53a6a37f1343e7bc1cec102848067d"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>lock-creation</from>
					<to>name</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="f8367a37a17a48528ba1746c60f1ab1a"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>false</from>
					<to>local</to>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="7efa641ac4c54cf1a807dc1c78cb7729"
				lineNumber="5">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="c7418ca5e7d5471d9e895b9316327b33"
					serviceId="nabu.frameworks.locks.crud.lockDefinition.services.list"
					resultName="resultb10da90d49944a95ab9b54c902754fd9"
					temporaryMapping="true"
					x="127"
					y="51"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="f9d83ec7ee3246958f3af04ebe8c61c2"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/name</from>
					<to>filter/name[0]</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="e0d8154f18ff4ec4b4bc55bb0ffa889c"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultb10da90d49944a95ab9b54c902754fd9/results[0]</from>
				<to>lockDefinition</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="c487267f78984a4ea6afc557f9746e26"
				label="!lockDefinition"
				lineNumber="6">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="c8d31cfba6814d019f94aba6669f07dc"
					serviceId="nabu.frameworks.locks.crud.lockDefinition.services.create"
					resultName="resultd13699a01523446da43c3257320aa568"
					temporaryMapping="true"
					x="102"
					y="114"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="5e7dd7fdb30742bbbc140c65f9f284d5"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/name</from>
					<to>instance/name</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="7820e7ef29104e23a6fb4dc5339986a4"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>Generated by system</from>
					<to>instance/description</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="bf348d9f89e544529e43051a5601ba28"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>PT1H</from>
					<to>instance/timeout</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="04daa728595d4fc7b15cbfda9bcfe4b0"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>instance/refreshTimeoutOnUse</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="e17668e7e1cf409db61b43e4adb29ffb"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultd13699a01523446da43c3257320aa568/created</from>
				<to>lockDefinition</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Finally"
				disabled="false"
				id="3e369a53efa14748a413e918553573b9"
				lineNumber="7">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="f680088c5dcd4da2810cc803d534711c"
					lineNumber="8">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="35a908c04825492eb3726c611f0c2fb9"
						serviceId="nabu.utils.Lock.unlock"
						resultName="resulteb44ea18ac0c4bf89374a52ba4e84091"
						temporaryMapping="true"
						x="235"
						y="209"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="64d41d34d9fc478eb5742c5a5ad7a5b4"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>lock-creation</from>
						<to>name</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="9ea0aacf5aab4ab0b565558e247dc2dd"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>false</from>
						<to>local</to>
					</steps>
				</steps>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="81e797397da5480bbf20716b96cdbc80"
			lineNumber="9">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="ec06c3ee2656411992093f8103a774c5"
				serviceId="nabu.frameworks.locks.crud.lockInstance.services.list"
				resultName="resultb34aeba4e2264f378a868e30c32dafc0"
				temporaryMapping="true"
				x="425"
				y="114"
				invocationOrder="1"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="db9ce1d57386400a99c2fc1346e27ebf"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>lockDefinition/id</from>
				<to>filter/lockDefinitionId[0]</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="b91e865089114dfeb16db3c6b071e113"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/lockedInstanceId</from>
				<to>filter/lockedInstanceId[0]</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="362e3af4a2ac4e3c89f759aec64deb9e"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result51483d88eb57460c869bde5c085cdba2/date</from>
				<to>filter/activeAt</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="4aacf5acabd7468fbe834be74c724b6d"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultb34aeba4e2264f378a868e30c32dafc0/results[0]</from>
			<to>lockInstance</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="58ed57c9efd1464abbf808e3a9a095ef"
				serviceId="nabu.utils.Date.now"
				resultName="result51483d88eb57460c869bde5c085cdba2"
				temporaryMapping="true"
				x="91"
				y="400"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="c6ca7e50103b49c9877b023ce140cad7"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result51483d88eb57460c869bde5c085cdba2/date</from>
			<to>date</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
			disabled="false"
			id="a6a24faf9b32405dbb6064b701518ff7"
			label="lockInstance/lockedInstanceId != null &amp;&amp; input/lockedInstanceId == null"
			lineNumber="10"
			message="Requesting global lock for instantiated locks"
			whitelist="false" xsi:nil="true"/>
	<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
			comment="We either have a lock instance or we don't"
			disabled="false"
			id="785322de51a14e97a2fbfa7ba358a68f"
			lineNumber="11">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="If we don't, create a new instance!"
				disabled="false"
				id="2d9c879dffaa422498fc1d0ae6f212f5"
				label="lockInstance == null"
				lineNumber="12">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="252fd10e5e754e23b1bbd66e75cb534c"
					serviceId="nabu.frameworks.locks.crud.lockInstance.services.create"
					resultName="resultf5838501c7e441fb83a4ff35bac3b0c2"
					temporaryMapping="true"
					x="455"
					y="80"
					invocationOrder="1"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="614fc08bcc9d459d9121166ed5ebe213"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>lockDefinition/id</from>
					<to>instance/lockDefinitionId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="6d0a49cdaa9047c1a21cc6b4c6d25047"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>date</from>
					<to>instance/locked</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="56ba382211ce4354b8afa44685a949b1"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resultf47b5459c5c842f9855d6d23ce1b4f55/date</from>
					<to>instance/expires</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="448f48dc2b0744fc8c2213e671c214df"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/lockedById</from>
					<to>instance/lockedById</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="99819c0c96e3439082c9f1cd421912dd"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/lockedInstanceId</from>
					<to>instance/lockedInstanceId</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="40056df7661f45bb9e6149fa4051daf1"
					serviceId="nabu.utils.Date.incrementDuration"
					resultName="resultf47b5459c5c842f9855d6d23ce1b4f55"
					temporaryMapping="true"
					x="60"
					y="308"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="afdf2e61d3a8435fb079621ad17969da"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>date</from>
					<to>start</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="e12fdd59cfba4c64920e2a09e66b4485"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>lockDefinition/timeout</from>
					<to>duration</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="45bec99c6f0a4310960408a65390af23"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>true</from>
				<to>output/locked</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
				comment="If the lock is yours, check if we need to refresh the expiry date"
				disabled="false"
				id="b5e661fd1f0d40658326dce0be2e306b"
				label="lockInstance/lockedById == input/lockedById"
				lineNumber="13">
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					comment="It is your lock, update the timeout if necessary"
					disabled="false"
					id="096101fd5244407aad3cfd29a49e470e"
					label="lockDefinition/refreshTimeoutOnUse"
					lineNumber="14">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						disabled="false"
						id="73aa18b54656477f84232df26d94a22e"
						lineNumber="15">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="58d0b45f495d4f01afbaa004b9559c65"
							serviceId="nabu.utils.Date.incrementDuration"
							resultName="result66f589baeee8432aa13709a38f6878cf"
							temporaryMapping="true"
							x="236"
							y="143"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="506ff1dc6dc04164ab864776f25757f2"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>date</from>
							<to>start</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="2af0f9ac3d0d4904a8a63da3bd34fa04"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>lockDefinition/timeout</from>
							<to>duration</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="97faec35f42a4490a80280f9bef0dcbf"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result66f589baeee8432aa13709a38f6878cf/date</from>
						<to>lockInstance/expires</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Update and set true"
						disabled="false"
						id="ca9784e63f9343538b12c3d67cd12784"
						lineNumber="16">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="47cb87d8730a46dabf6238653cc3d7d1"
							serviceId="nabu.services.jdbc.Services.update"
							resultName="resultd8a072627297432fa13f12cb2c61e01e"
							temporaryMapping="true"
							x="92"
							y="57"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="4ef8d5e87fbe42cea594f756da727af7"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>lockInstance</from>
							<to>instances[0]</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="d773b51535a74398a9cbfd8072b32160"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>true</from>
						<to>output/locked</to>
					</steps>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="It's your lock, set to true"
					disabled="false"
					id="bf16dbb7d7974290b7c4329b1eca7da1"
					lineNumber="17">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="903917c1147f4217a299b4b5dce2ac8a"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>output/locked</to>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Set to false"
				disabled="false"
				id="ac1fbbaae2834f0985067dd097ee2fbe"
				lineNumber="18">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="ac94979870514efb93c789a492f43042"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>false</from>
				<to>output/locked</to>
			</steps>
		</steps>
	</steps>
</sequence>